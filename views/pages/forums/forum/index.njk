<ul class="forum">
	{% include "./style.njk" %}
	{% lookup 'forums', {_id: forumid}, {}, 'forum' %}
	{% query 'topics', {parent: forum._id}, {date: -1}, 'topics' %}

	{% if topics.length != 0 %}
		<li class="header">
			<ul>
				<li>Topic</li>
				<li>Replies</li>
				<li>Most Recent</li>
			</ul>
		</li>

		{% for topic in topics %}
			{% lookup 'users', {_id: topic.author}, {}, 'author' %}
			{% query 'replies', {parent: topic._id}, {date: -1}, 'replies' %}
			<li class="topic">
				<ul>
					<li>
						<a class="topic-name" onclick="crpGetPage('/forums/{{forum.slug}}/{{topic._id}}')">{{topic.title}}</a>
						<div class="topic-author">
							Started By: <a onclick="crpGetPage('/members/{{author.nicename}}')">{{author.display_name}}</a>
						</div>
					</li>
					<li>{{replies.length}}</li>
					<li>No Replies</li>
				</ul>
			</li>
		{% endfor %}
	{% endif %}

	{% lookup 'users', {_id: userid}, {}, 'user' %}
	{% if user and user.role != 'pending' %}
		<script>crpTinyMCE()</script>
		<fieldset class="new-post">
			<legend>Create New Topic in {{forum.name}}</legend>
			<form>
				<label for="topic_title">Topic Title (Max: 80)</label>
				<input type="text" name="topic_title" class="topic_title" maxlength="80" />

				<textarea name="topic_body" class="topic_body tinymce"></textarea>

				{% if user.role == 'chapter_leader' or user.role == 'administrator' %}
					<label for="topic_type">Topic Type:</label>
					<select name="topic_type" class="topic_type">
						<option value="normal" selected>Normal</option>
						<option value="sticky">Sticky</option>
					</select>
				{% endif %}

				<input type="hidden" name="topic_parent" class="topic_parent" value="{{forum._id}}" />
				<input type="submit" value="Post" />
				<span class="topic-error"></span>
			</form>
		</fieldset>
	{% endif %}

	{% include "./script.njk" %}
</ul>
