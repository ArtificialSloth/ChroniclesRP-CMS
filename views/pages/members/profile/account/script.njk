<script>
	$('.user-account-form').submit((e) => {
		e.preventDefault();
		tinymce.triggerSave();

		var formData = new FormData(e.target);
		crpAjaxUpload('/api/admin/edit-user', formData, (res) => {
			$('.user-account-form .user_dob').parent().removeClass('error');
			$('.user-account-form .user_timezone').parent().removeClass('error');
			$('.user-account-form .user_gender').parent().removeClass('error');
			$('.user-account-form .display_name').parent().removeClass('error');
			$('.user-account-form .profile_pic').parent().removeClass('error');
			$('.user-account-form .cover_pic').parent().removeClass('error');

			if (!res._id) {
				if (res == 'dobInvalid') {
					$('.user-account-form .user_dob').parent().addClass('error');
					$('.user-account-form .user_dob + .input-error').html('Invalid date!');
				} else if (res == 'tzInvalid') {
					$('.user-account-form .user_timezone').parent().addClass('error');
					$('.user-account-form .user_timezone + .input-error').html('Timezone invalid!');
				} else if (res == 'genderInvalid') {
					$('.user-account-form .user_gender').parent().addClass('error');
					$('.user-account-form .user_gender + .input-error').html('Gender invalid!');
				} else if (res.code == 'LIMIT_FILE_SIZE' && res.field == 'profile_pic') {
					$('.user-account-form .profile_pic').parent().addClass('error');
					$('.user-account-form .profile_pic + .input-error').html('File size must be < 2 MB');
				} else if (res.code == 'LIMIT_FILE_SIZE' && res.field == 'cover_pic') {
					$('.user-account-form .cover_pic').parent().addClass('error');
					$('.user-account-form .cover_pic + .input-error').html('File size must be < 2 MB');
				} else {
					console.error(res);
					$('.user-account-form .display_name').parent().addClass('error');
					$('.user-account-form .display_name + .input-error').html('Something went wrong :(');
				}
			} else {
				crpGetPage(window.location.pathname);
			}
		});
	});
</script>
