{% include "./style.njk" %}
{% lookup 'users', {_id: userid}, {}, 'user' %}
{% query 'posts', {}, {title: 1}, 'posts' %}

{% set pages = crp.util.filterObjectArray(posts, {type: 'page'}) %}
{% set news = crp.util.filterObjectArray(posts, {type: 'news'}) %}
{% set featured = crp.util.filterObjectArray(posts, {type: 'featured_content'}) %}

<div class="posts-menu">
	<button class="filter all active" onclick="postsToggleTypeFilter(this, 'all')">All ({{posts.length}})</button>

	{% if pages.length > 0 %}
		<button class="filter pages" onclick="postsToggleTypeFilter(this, 'pages')">Pages ({{pages.length}})</button>
	{% endif %}

	{% if news.length > 0 %}
		<button class="filter news" onclick="postsToggleTypeFilter(this, 'news')">News ({{news.length}})</button>
	{% endif %}

	{% if featured.length > 0 %}
		<button class="filter featured-content" onclick="postsToggleTypeFilter(this, 'featured-content')">Featured Content ({{featured.length}})</button>
	{% endif %}
</div>

<div class="posts-content">
	<div class="table">
		<div class="table-row table-header">
			<div class="table-header-data">Title</div>
			<div class="table-header-data">Slug</div>
			<div class="table-header-data">Date</div>
		</div>
		<div class="filter all active">
			{% for post in posts %}
				{% include "./loop.njk" %}
			{% endfor %}
		</div>
		<div class="filter pages">
			{% for post in pages %}
				{% include "./loop.njk" %}
			{% endfor %}
		</div>
		<div class="filter news">
			{% for post in news %}
				{% include "./loop.njk" %}
			{% endfor %}
		</div>
		<div class="filter featured-content">
			{% for post in featured %}
				{% include "./loop.njk" %}
			{% endfor %}
		</div>
	</div>
</div>

<fieldset class="add-post">
	<legend>Add New Post</legend>
	<form>
		<label for="post_title">Title: </label>
		<input type="text" name="post_title" class="post_title" />

		<br />

		<label for="post_type">Type: </label>
		<select name="post_type" class="post_type">
			<option value="page">Page</option>
			<option value="news">News</option>
			<option value="featured_content">Featured Content</option>
		</select>

		<br />

		<label for="post_slug">Slug: </label>
		<input type="text" name="post_slug" class="post_slug" />

		<br />

		<label for="post_img">Featured Image: </label>
		<input type="text" name="post_img" class="post_img" />

		<br />

		<textarea name="post_content" class="post_content tinymce"></textarea>
		<script>crpTinyMCE()</script>

		<input type="submit" value="Post" />
	</form>
</fieldset>

{% include "./script.njk" %}
