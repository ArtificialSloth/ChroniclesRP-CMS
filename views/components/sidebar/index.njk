<div class="sidebar">
	{% include "./style.njk" %}
	{% lookup 'users', {_id: userid}, 'user' %}

	<div class="login-widget">
		<h3></h3>

		{% if user %}
			<ul>
				<li><img src="{{crp.members.getProfilePic(user)}}" /></li>
				<li>
					<a href="/members/{{user.nicename}}">{{user.display_name}}</a>
					<a class="redirect" href="/logout">Logout</a>
				</li>
			</ul>
		{% else %}
			<form class="login-form">
				<label for="login">Username</label>
				<input type="text" name="login" placeholder="Username" />

				<label for="pass">Password</label>
				<input type="password" name="pass" placeholder="Password" />

				<div class="error-message"></div>

				<input type="checkbox" name="remember_me" class="remember_me" /> <input type="button" onclick="$('.remember_me').prop('checked', !$('.remember_me').prop('checked'))" value="Remember me" />
				<input type="button" value="Login" onclick="loginSubmit(this)">
			</form>

			{% include "components/login/script.njk" %}
		{% endif %}
	</div>

	<div class="recent-posts-widget">
		{% getTopics {}, 'topics' %}

		<h3>Recent Posts</h3>
		<ul>
			{% set i = 0 %}
			{% for topic in topics %}
				{% if i < 5 %}
					{% lookup 'users', {_id: topic.author}, 'author' %}
					{% lookup 'forums', {_id: topic.parent}, 'forum' %}
					{% lookup 'categories', {_id: forum.category}, 'category' %}

					{% if not category.role or user.role >= category.role %}
						<li>
							{% if topic.sortAuthor %}
								{% lookup 'users', {_id: topic.sortAuthor}, 'sortAuthor' %}
								<a href="/members/{{sortAuthor.nicename}}">{{sortAuthor.display_name}}</a>
								replied to
							{% endif %}
							<a href="/forums/{{forum.slug}}/{{topic._id}}">{{topic.title}}</a>
							by
							<a href="/members/{{author.nicename}}">{{author.display_name}}</a>
							<br />
							{{crp.moment(topic.sortDate).fromNow()}}
						</li>
						{% set i = i + 1 %}
					{% endif %}
				{% endif %}
			{% endfor %}
		</ul>
	</div>
</div>
